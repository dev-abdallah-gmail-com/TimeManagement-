@page "/tags/manage"
@using TimeManagement.Client.Services
@inject IApiService Api
@using System.Net.Http.Json

<h3>Manage Tags</h3>

<div class="mb-3 row">
 <div class="col-sm-8">
 <input @bind="newTagName" class="form-control" placeholder="Tag name" />
 </div>
 <div class="col-sm-4">
 <button class="btn btn-primary" @onclick="AddTag">Add Tag</button>
 </div>
</div>

@if (tags == null)
{
 <p><em>Loading...</em></p>
}
else
{
 <table class="table">
 <thead><tr><th>Name</th><th>Color</th><th></th></tr></thead>
 <tbody>
 @foreach (var t in tags)
 {
 <tr>
 <td>@t.Name</td>
 <td>@t.Color</td>
 <td><button class="btn btn-danger btn-sm" @onclick="() => DeleteTag(t.Id)">Delete</button></td>
 </tr>
 }
 </tbody>
 </table>
}

@code {
 private List<TagDto>? tags;
 private string newTagName = string.Empty;

 protected override async Task OnInitializedAsync()
 {
 await Load();
 }

 private async Task Load()
 {
 try
 {
 tags = await Api.GetAllTagsAsync();
 }
 catch
 {
 tags = new List<TagDto>();
 }
 }

 private async Task AddTag()
 {
 try
 {
 var dto = new CreateTagModel { Name = newTagName, Color = "#cccccc" };
 var res = await Api.CreateTagAsync(dto);
 if (res != null)
 {
 newTagName = string.Empty;
 await Load();
 }
 }
 catch
 {
 }
 }

 private async Task DeleteTag(int id)
 {
 try
 {
 var ok = await Api.DeleteTagAsync(id);
 if (ok) await Load();
 }
 catch
 {
 }
 }
}
